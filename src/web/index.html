<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content, viewport-fit=cover">
    <title>Clay MUD Client</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div id="app">
        <!-- Toolbar -->
        <div id="toolbar">
            <div id="toolbar-left">
                <button id="menu-btn" class="toolbar-btn hamburger-btn" title="Menu"><svg width="18" height="14" viewBox="0 0 18 14"><rect y="0" width="18" height="2" fill="#c0c0c0"/><rect y="6" width="18" height="2" fill="#c0c0c0"/><rect y="12" width="18" height="2" fill="#c0c0c0"/></svg></button>
                <div id="menu-dropdown" class="dropdown">
                    <div class="dropdown-item" data-action="worlds">Worlds List</div>
                    <div class="dropdown-item" data-action="world-selector">World Selector</div>
                    <div class="dropdown-item" data-action="actions">Actions</div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" data-action="toggle-tags">Toggle Tags</div>
                </div>
                <button id="font-small" class="font-btn" title="Small font (phone)">S</button>
                <button id="font-medium" class="font-btn active" title="Medium font (default)">M</button>
                <button id="font-large" class="font-btn" title="Large font (tablet)">L</button>
                <span id="toolbar-title">Clay MUD Client</span>
            </div>
        </div>

        <!-- Main output area -->
        <div id="output-container">
            <div id="output"></div>
        </div>

        <!-- Mobile toolbar (phones/tablets only) -->
        <div id="mobile-toolbar">
            <div id="mobile-toolbar-left">
                <button id="mobile-menu-btn" class="mobile-btn" title="Menu"><svg width="18" height="14" viewBox="0 0 18 14"><rect y="0" width="18" height="2" fill="#c0c0c0"/><rect y="6" width="18" height="2" fill="#c0c0c0"/><rect y="12" width="18" height="2" fill="#c0c0c0"/></svg></button>
                <div id="mobile-menu-dropdown" class="dropdown">
                    <div class="dropdown-item" data-action="worlds">Worlds List</div>
                    <div class="dropdown-item" data-action="world-selector">World Selector</div>
                    <div class="dropdown-item" data-action="actions">Actions</div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" data-action="toggle-tags">Toggle Tags</div>
                </div>
                <button id="mobile-up-btn" class="mobile-btn" title="Previous World">▲</button>
                <button id="mobile-down-btn" class="mobile-btn" title="Next World">▼</button>
                <button id="mobile-tag-btn" class="mobile-btn" title="Toggle Tags (F2)">Tag</button>
            </div>
            <div id="mobile-toolbar-right">
                <button id="mobile-pgup-btn" class="mobile-btn" title="Page Up">PgUp</button>
                <button id="mobile-pgdn-btn" class="mobile-btn" title="Page Down">PgDn</button>
            </div>
        </div>

        <!-- Separator bar (like console) -->
        <div id="status-bar">
            <span id="status-indicator">___________</span>
            <span id="world-name"></span>
            <span id="activity-indicator"></span>
            <span id="separator-fill"></span>
            <span id="status-time"></span>
        </div>

        <!-- Input area -->
        <div id="input-container">
            <span id="prompt"></span>
            <textarea id="input" autocomplete="off" autofocus rows="1"></textarea>
            <button id="send-btn">Send</button>
        </div>

        <!-- Authentication modal -->
        <div id="auth-modal" class="modal">
            <div class="modal-content">
                <h2>Authentication Required</h2>
                <p>Enter the WebSocket password to connect:</p>
                <input type="password" id="auth-password" autocomplete="off">
                <div id="auth-error" class="error"></div>
                <button id="auth-submit">Connect</button>
            </div>
        </div>

        <!-- Connection status overlay -->
        <div id="connecting-overlay" class="overlay">
            <div class="overlay-content">
                <div class="spinner"></div>
                <p>Connecting...</p>
            </div>
        </div>

        <!-- Actions List popup (first window) -->
        <div id="actions-list-modal" class="modal">
            <div class="modal-content actions-list-modal-content">
                <h2>Actions</h2>
                <div id="actions-list" class="actions-list"></div>
                <div class="modal-buttons">
                    <button id="action-add-btn" class="action-btn">Add</button>
                    <button id="action-edit-btn" class="action-btn">Edit</button>
                    <button id="action-delete-btn" class="action-btn">Delete</button>
                    <button id="action-cancel-btn" class="action-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Actions Editor popup (second window) -->
        <div id="actions-editor-modal" class="modal">
            <div class="modal-content actions-editor-modal-content">
                <h2 id="action-editor-title">Edit Action</h2>
                <div class="action-field">
                    <label for="action-name">Name:</label>
                    <input type="text" id="action-name" autocomplete="off">
                </div>
                <div class="action-field">
                    <label for="action-world">World:</label>
                    <input type="text" id="action-world" autocomplete="off" placeholder="(empty = all worlds)">
                </div>
                <div class="action-field">
                    <label for="action-pattern">Pattern:</label>
                    <input type="text" id="action-pattern" autocomplete="off" placeholder="(regex, empty = manual only)">
                </div>
                <div class="action-field">
                    <label for="action-command">Command:</label>
                    <textarea id="action-command" rows="5" autocomplete="off" placeholder="Commands (semicolon-separated)"></textarea>
                </div>
                <div id="action-error" class="error"></div>
                <div class="modal-buttons">
                    <button id="action-save-btn">Save</button>
                    <button id="action-editor-cancel-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Action Delete Confirmation popup -->
        <div id="action-confirm-modal" class="modal">
            <div class="modal-content action-confirm-modal-content">
                <p id="action-confirm-text">Delete this action?</p>
                <div class="modal-buttons">
                    <button id="action-confirm-yes-btn">Yes</button>
                    <button id="action-confirm-no-btn">No</button>
                </div>
            </div>
        </div>

        <!-- Worlds list popup (/worlds or /l) -->
        <div id="worlds-modal" class="modal">
            <div class="modal-content worlds-modal-content">
                <h2>Connected Worlds</h2>
                <div id="worlds-table-container">
                    <table id="worlds-table">
                        <thead>
                            <tr>
                                <th>World</th>
                                <th>Unseen</th>
                                <th>Send/Recv</th>
                                <th>KeepAlive</th>
                                <th>Last/Next</th>
                            </tr>
                        </thead>
                        <tbody id="worlds-table-body"></tbody>
                    </table>
                </div>
                <div class="modal-buttons">
                    <button id="worlds-close-btn">Close</button>
                </div>
            </div>
        </div>

        <!-- World selector popup (/world) -->
        <div id="world-selector-modal" class="modal">
            <div class="modal-content world-selector-modal-content">
                <h2>World Selector</h2>
                <div class="world-selector-filter">
                    <input type="text" id="world-filter" placeholder="Filter worlds..." autocomplete="off">
                </div>
                <div id="world-selector-list" class="world-selector-list"></div>
                <div class="modal-buttons">
                    <button id="world-edit-btn">Edit</button>
                    <button id="world-connect-btn">Connect</button>
                    <button id="world-switch-btn">Switch</button>
                    <button id="world-selector-cancel-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Web Settings popup (/web) -->
        <div id="web-modal" class="modal">
            <div class="modal-content web-modal-content">
                <h2>Web Settings</h2>
                <div class="web-settings-form">
                    <div class="web-field">
                        <label>Protocol:</label>
                        <button id="web-protocol-btn" class="toggle-btn">Non-Secure</button>
                    </div>
                    <div class="web-field">
                        <label id="http-label">HTTP enabled:</label>
                        <button id="web-http-enabled-btn" class="toggle-btn">off</button>
                    </div>
                    <div class="web-field">
                        <label id="http-port-label">HTTP port:</label>
                        <input type="text" id="web-http-port" autocomplete="off" class="web-input">
                    </div>
                    <div class="web-field">
                        <label id="ws-label">WS enabled:</label>
                        <button id="web-ws-enabled-btn" class="toggle-btn">off</button>
                    </div>
                    <div class="web-field">
                        <label id="ws-port-label">WS port:</label>
                        <input type="text" id="web-ws-port" autocomplete="off" class="web-input">
                    </div>
                    <div class="web-field">
                        <label>Allow List:</label>
                        <input type="text" id="web-allow-list" autocomplete="off" class="web-input" placeholder="localhost, 192.168.*">
                    </div>
                    <div class="web-field tls-field" id="tls-cert-field" style="display: none;">
                        <label>TLS cert file:</label>
                        <input type="text" id="web-cert-file" autocomplete="off" class="web-input" placeholder="/path/to/cert.pem">
                    </div>
                    <div class="web-field tls-field" id="tls-key-field" style="display: none;">
                        <label>TLS key file:</label>
                        <input type="text" id="web-key-file" autocomplete="off" class="web-input" placeholder="/path/to/key.pem">
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="web-save-btn">Save</button>
                    <button id="web-cancel-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket configuration injected by server
        window.WS_PORT = {{WS_PORT}};
        window.WS_PROTOCOL = '{{WS_PROTOCOL}}';
    </script>
    <script src="/app.js"></script>
</body>
</html>
